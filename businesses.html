{% extends "base.html" %}

{% block content %}
	<a href="#updateBusiness" class="updateOrCreateBusiness btn" data-type="create" role="button" onclick="javascript: createBusinessClick()">Create New Business</a>
	<div id="removeBusiness" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
			<h3>Hide Business:</h3>
			<h4 class="text-info businessNameLabel"></h4>
		</div>
		<form action="/businessservice/createOrUpdate" name="update_business_form" method="post" class="form-horizontal">
			<input type="hidden" class="business_id" name="business_id">
			<input type="hidden" name="createOrUpdate" value="hide">			
			<div class="modal-body">
			    <p>This will hide the Business From App Results</p>	
			</div>			
		</form>
		<div class="modal-footer">
			<button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
			<button type="submit" class="btn btn-primary">Hide Business</button>
		</div>
	</div>	
	{% if businesses %}
		<div class="row">
			<div class="span12">
				<hr class="bs-docs-separator"/>
			</div>
			<div class="span12">
				<table class="table table-hover">
					<thead>
						<th scope="col">Edit</th>
						<th scope="col">Hidden</th>
						<th scope="col">Name</th>
						<th scope="col">ID</th>
						<th scope="col">Website Address</th>			
						<th scope="col">Province</th>
						<th scope="col">City</th>
						<th scope="col">Street</th>
						<th scope="col">Phone</th>
						<th scope="col">Map</th>
						<th scope="col">Json</th>
					</thead>
					<tbody>
					    {% for business in businesses %}
							<tr>
								<td>
									<div class="btn-group">
										<a class="btn btn-mini dropdown-toggle" data-toggle="dropdown" href="#">
										Edit
										<span class="caret"></span>
										</a>
										<ul class="dropdown-menu">
											<li><a href="#updateBusiness" role="button" class="updateOrCreateBusiness" data-id="{{ business.business_id|escape }}" data-type="update"><i class="icon-pencil"></i> Update</a></li>
											<li><a href="#removeBusiness" role="button" class="removeBusiness" data-id="{{ business.business_id|escape }}" data-name="{{ business.name|escape }}"><i class="icon-trash"></i> Hide</a></li>
										</ul>
									</div>
								</td>
								<td>{% if business.hidden %}<i class="icon-remove"></i>{% endif %}</td>
								<td>{{ business.name|escape }}</td>
								<td>{{ business.business_id|escape }}</td>
								<td><a href="{{ business.url|escape }}">{{ business.url|escape }}</a></td>
								<td>{{ business.province|escape }}</td>
								<td>{{ business.city|escape }}</td>
								<td>{{ business.street|escape }}</td>
								<td>{{ business.phonenumber|escape }}</td>
								{% if business.geolocation %}
									<td><a target="_blank"  href="{{ business.mapurl }}">Map</a></td>
								{% else %}
									<td></td>
								{% endif %}
								<td><a target="_blank" href="/api/business/{{ business.business_id|escape }}">Json</a></td>
							</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
		</div>
	{% endif %}
{% endblock %}
{% block scripts %}
	<script type="text/javascript">
		function submitform()
		{
		  document.createOrUpdate_business_form.submit();
		}
		$(document).ready(function(){		
		   $(".removeBusiness").click(function(){
		     $("#removeBusiness .business_id").val($(this).data('id'));
			 $('#removeBusiness .businessNameLabel').text($(this).data('name'));
		     $('#removeBusiness').modal('show');
		   });
		});
		$(document).ready(function() {
			$('.updateOrCreateBusiness').click(function(e) {
				e.preventDefault();				
				var modal_type = $(this).data('type')
				var url = '/businessservice/loadModal'		
				if (modal_type == 'update') {
					var business_id = $(this).data('id')
					var url = '/businessservice/loadModal?business_id=' + business_id;
				}
				$.get(url, function(data) {
					$('<div class="modal hide fade">' + data + '</div>').modal();
				}).success(function() { $('input:text:visible:first').focus(); });
			});
		});
	</script>
{% endblock %}